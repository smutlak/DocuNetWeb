<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:pe="http://primefaces.org/ui/extensions">
    <h:head>
        <title>MIS DocuNet Web Portal</title>

    </h:head>
    <style>
        .imageWrapperClass {
            height: 86vh; /* vh stands for view-port height, 1vh is 1% of screen height */
            display:block; 
            width:100%; 
            margin:auto; 
            overflow:scroll; 
            position:relative;
            height: 550px\9;
            page-break-inside: avoid;
        }
        html,body{
            font-size: small;
        }
    </style>
    <style type="text/css" media="print">
        @page {
            size: landscape;
        }
        body{
            writing-mode: tb-rl;
        }
    </style>
    <script type="text/javascript" >

//        $.fn.attachDragger = function () {
//            var attachment = false, lastPosition, position, difference;
//            $($(this).selector).on("mousedown mouseup mousemove", function (e) {
//                if (e.type == "mousedown")
//                    attachment = true, lastPosition = [e.clientX, e.clientY];
//                if (e.type == "mouseup")
//                    attachment = false;
//                if (e.type == "mousemove" &amp;&amp; attachment == true) {
//                    position = [e.clientX, e.clientY];
//                    difference = [(position[0] - lastPosition[0]), (position[1] - lastPosition[1])];
//                    $(this).scrollLeft($(this).scrollLeft() - difference[0]);
//                    $(this).scrollTop($(this).scrollTop() - difference[1]);
//                    lastPosition = [e.clientX, e.clientY];
//                }
//            });
//            $(window).on("mouseup", function () {
//                attachment = false;
//            });
//        }

        function addEvent() {
            console.log('Entering addEvent');
            //console.log(document.getElementById('dndViewerForm:loaderAjax').src);

            document.getElementById('dndViewerForm:loaderAjax').style.display = '';

            $("#dndViewerForm\\:myImage").on("load", function () {
                console.log('complete loading');
                document.getElementById('dndViewerForm:loaderAjax').style.display = 'none';
                console.log('Reset progress bar');
                document.getElementById('dndViewerForm:loaderAjax').src = document.getElementById('dndViewerForm:loaderAjax').src + "?a=" + Math.random();
                //addEvent();
            }).each(function () {
                if (this.complete) {
                    $(this).trigger('load');
                    //console.log('start loading');
                    //document.getElementById('dndViewerForm:loaderAjax').style.display = '';
                }
            });
        }
        //jQuery(document).ready(addEvent);
//        $(document).ready(function () {
//            $("#dndViewerForm\\:myImage").attachDragger();
//        });
    </script>
    <f:metadata>
        <f:viewParam name="dndID" value="#{documentController.dndID}"/>
    </f:metadata>

    <h:body>
        <!--        <p:ajaxStatus onstart="document.getElementById('dndViewerForm:loaderAjax').style.display='';" 
                              onsuccess="document.getElementById('dndViewerForm:loaderAjax').style.display='none'" />-->
        <h:form id="dndViewerForm" onsubmit="return false;">
            <p:outputPanel id="empty" rendered="#{!documentController.hasPages()}">  
                <h1>NO VALID PAGES</h1>
            </p:outputPanel>
            <p:outputPanel id="dndViewer" rendered="#{documentController.hasPages()}">  
                <p:growl id="growl" showDetail="true" sticky="true" />  

                <p:outputPanel id="imageWrapper" styleClass="imageWrapperClass">           
                    <p:graphicImage id="myImage" styleClass="mainPageImage" style="width:100%;" value="#{documentController.currPage}" 
                                    cache="false">
                        <!--<f:param name="inv" value="#{documentController.currIndex}" />-->
                    </p:graphicImage>
                    <script type="text/javascript">
                        $(document).ready(addEvent);
                    </script>
                    <pe:imageRotateAndResize id="rotateAndResize" for="myImage" widgetVar="rotateAndResizeWidget">  
                        <p:ajax event="rotate" listener="#{documentController.rotateListener}"  
                                update="growl" />  
                        <pe:javascript event="resize"/>  
                    </pe:imageRotateAndResize> 
                </p:outputPanel>



                <div style=" min-height: 20px;">
                    <p:graphicImage id="loaderAjax" name="/images/ajax-load.gif" style=" display:none;width:100%;height:20px;" />
                </div>

                <p:remoteCommand name="processPageNo"
                                 update="imageWrapper"/>
                <p:message for="requestedPageNoEdit" id="requestedPageNoEditMessage" />
                <p:defaultCommand target="requestedPageNoEdit" />

                <h:panelGrid id="controlsButtons" columns="4" style="width:100%" >
                    <h:panelGrid columns="6">
                        <p:commandButton actionListener="#{documentController.firstPage()}" value="الصفحة الاولى"  
                                         update="imageWrapper, controlsButtons" disabled="#{documentController.firstPage}" />
                        <p:commandButton actionListener="#{documentController.prevPage()}" value="الصفحة السايقة"  
                                         update="imageWrapper, controlsButtons" disabled="#{documentController.firstPage}" /> 

                        <p:inputText id="requestedPageNoEdit" value="#{documentController.requestedPageNo}" 
                                     maxlength="3" 
                                     size="3" 
                                     required="true"
                                     onkeydown="if (event.keyCode === 13) {
                                                console.log('enter key captured..');
                                                 processPageNo();
                                                 return false;
                                             }">
                            <f:validateLongRange minimum="1" maximum="60" />
                        </p:inputText>

                        <p:outputLabel id="pageFromLabel" value="#{documentController.pageFrom}"></p:outputLabel>
                        <p:commandButton ajax="true" actionListener="#{documentController.nextPage}" value="الصفحة اللاحقة"
                                         update="imageWrapper, controlsButtons" disabled="#{documentController.lastPage}"
                                         /> 
                        <p:commandButton ajax="true" actionListener="#{documentController.lastPage()}" value="الصفحة الاخيرة"
                                         update="imageWrapper,controlsButtons" disabled="#{documentController.lastPage}"/> 
                    </h:panelGrid>
                    <h:panelGrid columns="2">
                        <p:commandButton value="تدوير لليسار"  
                                         onclick="PF('rotateAndResizeWidget').rotateLeft(90);
                                                 return false;"/>  
                        <p:commandButton value="تدوير لليمين"  
                                         onclick="PF('rotateAndResizeWidget').rotateRight(90);
                                                 return false;"/>  
                    </h:panelGrid>
                    <h:panelGrid columns="3">
                        <p:commandButton value="0"  
                                         onclick="PF('rotateAndResizeWidget').restoreDefaults();
                                                 return false;"/>
                        <p:commandButton value="تكبير" 
                                         onclick="PF('rotateAndResizeWidget').scale(1.05);
                                                 return false;"/>  
                        <p:commandButton value="تصغير"  
                                         onclick="PF('rotateAndResizeWidget').scale(0.95);
                                                 return false;"/> 
                    </h:panelGrid>


                    <h:panelGroup style="text-align: right;">
                        <p:commandButton value="طباعة الصفحة" rendered="true" type="button" icon="pi pi-print">
                            <p:printer target="imageWrapper" />
                        </p:commandButton>
                    </h:panelGroup>
                </h:panelGrid>
            </p:outputPanel>  
        </h:form>
    </h:body>
</html>

